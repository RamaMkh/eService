USE [MicroclearLight_July23]
GO
/****** Object:  StoredProcedure [etrade].[usp_BRS_MApp_GetNotificationsList]    Script Date: 12/21/2023 4:17:18 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


ALTER procedure [etrade].[usp_BRS_MApp_GetNotificationsList] (  
  ---omar
 @mUserId INT    
 ,@lang VARCHAR(10)    
 )    
AS    
BEGIN    
 IF @lang = 'ar'    
 BEGIN   
   
  
    
  SELECT A.NotificationType    
   ,A.ReferenceId    
   ,A.DateCreated    
   ,A.ReadStatus    
   ,A.msg    
   ,A.TableName    
   ,A.ReffType    
   ,A.ReffId    
   ,A.NotificationId    
  FROM (    
   SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    ,N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    
    --ISNULL(Ors.LocalDescription,          
    --       ISNULL(Ors.NAME, ORs.RequestNumber))          
    --+ ' - ' + ISNUll(WFS_ara.StateName,          
    --                 ISNUll(WFS.StateName, '')) AS "msg",          
    CASE     
     WHEN WFS.StateName = 'Approved For Create'    
      THEN N' لقد تم الموافقة على طلبك ' + ' - ' + N' رقم ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '          
       + N' الخاص ' + CASE     
        WHEN NotificationType = 0    
         THEN N'بخدمة تسجيل الشركات '    
        END    
       --+ ' Has been Approved'          
     WHEN WFS.StateName = 'Approved For Update'    
      THEN N' لقد تم الموافقة على طلبك ' + + ' - ' + N' رقم ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '         
       + N' الخاص ' + CASE     
        WHEN NotificationType = 0    
         THEN N'بخدمة تسجيل الشركات '    
        END    
       -- New       
     WHEN WFS.StateName = 'Organization Requested For Create'    
      THEN N' لقد تم ارسال طلبك ' + + ' - ' + N' رقم ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '         
       + N' الخاص ' + CASE     
        WHEN NotificationType = 0    
         THEN N'بخدمة تسجيل الشركات '    
        END    
       -- End New        
       --+ ' Has been Approved'          
     WHEN WFS.StateName = 'Rejected'    
      THEN N' لقد تم رفض طلبك ' + ' - ' + N' رقم ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '        
       + N' الخاص ' + CASE     
        WHEN NotificationType = 0    
         THEN N' بخدمة تسجيل الشركات '    
        END    
       --+ ' Has been Rejected'          
       + N' و ذلك لما يلي ' + ' * ' + Ors.RejectionRemarks + ' * '    
     WHEN WFS.StateName = 'Request to visit Automation team'    
      THEN N' تم طلب حضورك الشخصي الى الإدارة المختصة بتسجيل الشركات بالجمارك بخصوص طلبك ' + ' - ' + N' رقم ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '         
       + N' الخاص ' + CASE     
        WHEN NotificationType = 0    
         THEN N'بخدمة تسجيل الشركات '    
        END + N' و ذلك لما يلي ' + ' * ' + Ors.RequestForVisitRemarks + ' * '    
     WHEN WFS.StateName = 'Request Additional Info'    
      THEN N' تم طلب تزويد المعلومات التالية ' + ' * ' + ORs.AdditionalInfoRemarks + ' * ' + N'  الى الإدارة المختصة بتسجيل الشركات بالجمارك بخصوص طلبك ' + ' - ' + N' رقم ' +   
   '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '          
       + N' الخاص ' + CASE     
        WHEN NotificationType = 0    
         THEN N'بخدمة تسجيل الشركات '    
        END    
     END "msg"    
    ,    
    -- Abd                           
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara ON WFS_ara.DataProfileClassWFStateId = WFS.DataProfileClassWFStateId    
   WHERE N.UserId = @mUserId    
    AND N.NotificationType = 0    
    AND N.NotificationId = (    
     SELECT max(NotificationId)    
     FROM [etrade].MobileNotification    
     WHERE ReferenceId = N.ReferenceId    
     )    
   --order by NotificationId desc                    
       
   UNION    
       
   SELECT DISTINCT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated        
    ,N.ReadStatus    
    ,    
    ----   '' AS StateName, --WFS.StateName          
    ----EA.StateId,          
    ----ECI.StateId 'CANDIDATE STATUS',          
    ---- ECI.ExamResult,          
    --CASE         
    -- WHEN EA.StateId = 'ExamsAnnouncementsFinalApprovalState' AND ECI.StateId = 'ExamCandidateInfoExamSentState' AND ISNULL(ECI.ExamResult, '') = ''        
    --  THEN CASE         
    --    WHEN NotificationType in (1041,1042,1043)       
    --     THEN N'تم تحديد موعد ومكان إنعقاد إختبار التخليص الجمركي، ' + N' الرجاء، تأكيد حضور الإختبار خلال 5 أيام من تاريخ هذه الرسالة و إلا سيتم إستبعاد طلبك'        
    --    END        
    -- WHEN EA.StateId = 'ExamsAnnouncementsFinalApprovalState' AND ECI.StateId = 'ExamCandidateInfoAttendanceConfirmedState'        
    --  THEN CASE         
    --    WHEN NotificationType in (1041,1042,1043)       
    --     THEN N'لقد قمت بتأكيد حضور اختبار التخليص الجمركي : ' + CONVERT(VARCHAR, EAD.DateOfExam, 103) + ', ' + EAD.PlaceOfExam    + ' ' + EA.StateId + ' ' + ECI.StateId    
    --    END        
    -- END "msg"       
    CASE     
     --WHEN NotificationType = 1041    
     -- THEN N'تم تحديد موعد ومكان إنعقاد إختبار التخليص الجمركي، ' + N' الرجاء، تأكيد حضور الإختبار خلال 5 أيام من تاريخ هذه الرسالة و إلا سيتم إستبعاد طلبك'    
     WHEN NotificationType = 1042    
      THEN N'تم تحديد موعد ومكان إنعقاد إختبار التخليص الجمركي، ' + N' الرجاء، تأكيد حضور الإختبار خلال 5 أيام من تاريخ هذه الرسالة و إلا سيتم إستبعاد طلبك'    
     --WHEN NotificationType = 1043    
     -- THEN N'تم تحديد موعد ومكان إنعقاد إختبار التخليص الجمركي، ' + N' الرجاء، تأكيد حضور الإختبار خلال 5 أيام من تاريخ هذه الرسالة و إلا سيتم إستبعاد طلبك'    
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,'' --N.NotificationId        
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   INNER JOIN [$ExamsAnnouncements] EA ON EA.ExamsAnnouncementId = N.ReferenceId    
    AND EA.StateId = 'ExamsAnnouncementsPublicationState'    
   INNER JOIN ExamsAnnouncementDetails EAD ON EAD.ExamsAnnouncementId = EA.ExamsAnnouncementId    
    AND EAD.StateId <> '    
ExamsAnnouncementDetailsDeleteState'    
   INNER JOIN [$ExamCandidateInfo] ECI ON ECI.ExamsAnnouncementDetailsId = EAD.ExamsAnnouncementDetailsId    
    AND ECI.StateId IN (    
     'ExamCandidateInfoAttendanceConfirmedState'    
     ,'ExamCandidateInfoExamSentState'    
     )    
   WHERE N.NotificationType IN (    
     --1041,    
     1042    
     --,1043    
     )    
    AND ISNULL(ECI.ExamResult, '') = ''    
    AND UserId = @mUserId --UserId = 423          
       
   UNION    
       
   -- 105               
   SELECT DISTINCT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    --,' - '+ CC.ArabicFirstName+' '+CC.ArabicSecondName+' '+CC.ArabicThirdName+' '+CC.ArabicLastName    
    ,    
    --   '' AS StateName, --WFS.StateName          
    --EA.StateId,         
    --ECI.StateId 'CANDIDATE STATUS',          
    --ECI.ExamResult,          
    CASE     
     WHEN NotificationType = 105    
      AND ECI.ExamResult = (    
       SELECT TYPEID    
       FROM TYPES    
       WHERE NAME = 'passed the exam'    
       ) --332294315        
      THEN N'لقد أجتزت إختبار التخليص الجمركي بنجاح، يمكنك التقدم بطلب اصدار رخصة تخليص.' + ' - ' + CC.ArabicFirstName + ' ' + CC.ArabicSecondName + ' ' + CC.ArabicThirdName + ' ' + CC.ArabicLastName    
     WHEN NotificationType = 105    
      AND ECI.ExamResult = (    
       SELECT TYPEID    
       FROM TYPES    
       WHERE NAME = 'not passing the exam'    
       ) --332294316        
      THEN N'لقد رسبت في اختبار التخليص الجمركي، يمكنك إعادة المحاولة في الإختبارات القادمة عن طريق إرسال طلب دخول أختبار جديد.' + ' - ' + CC.ArabicFirstName + ' ' + CC.ArabicSecondName + ' ' + CC.ArabicThirdName + ' ' + CC.ArabicLastName    
     WHEN NotificationType = 105    
      AND ECI.ExamResult = (    
       SELECT TYPEID    
       FROM TYPES    
       WHERE NAME = 'Not attending'    
       ) --332294317        
      THEN N'لم يتم الحضور و المشاركة في اختبار التخليص الجمركي، يمكنك ارسال طلب دخول أختبار جديد' + ' - ' + CC.ArabicFirstName + ' ' + CC.ArabicSecondName + ' ' + CC.ArabicThirdName + ' ' + CC.ArabicLastName    
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   INNER JOIN [ExamCandidateInfo] ECI ON ECI.ExamsAnnouncementDetailsId = N.ReferenceId    
    AND ECI.StateId = 'ExamCandidateInfoApprovedState'    
   INNER JOIN ETRADE.EServiceRequestsDetails CC ON CC.Eservicerequestid = ECI.Eservicerequestid    
   WHERE N.NotificationType = 105    
    AND N.UserId = @mUserId --UserId = 423          
    --  exec [etrade].[usp_BRS_MApp_GetNotificationsList] @mUserId = 673, @lang = 'ar'      
    --    SELECT * FROM ETRADE.MobileNotification mn WHERE mn.NotificationType=105    
    --   SELECT Eservicerequestid,* FROM [ExamCandidateInfo] WHERE Eservicerequestid=468 IN (31,    
    --33,    
    --32,    
    --34,    
    --35,    
    --36,    
    --37,    
    --38,    
    --39)    
    --   SELECT * FROM ETRADE.EServiceRequestsDetails WHERE etrade.EServiceRequestsDetails.RequestServicesId=7    
    --   SELECT * FROM ETRADE.Eservices e    
       
   UNION    
       
   SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    
    --ISNULL(ORs.EserviceRequestNumber,'')          
    -- + ' - ' + ISNUll(WFS_ara.StateName, WFS.StateName) AS "msg",    
	
    CASE     
     --  WHEN WFS.StateName = 'Submitted'     
	 

     WHEN WFS.StateName IN (    
       'Submitted'    
       ,'Initial Submitted'    
       ) AND RevokeActionDate IS NULL ---shk    
      THEN N'لقد تم ارسال طلبك رقم' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'بطلب تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'طلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
		 WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة' 
		 WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		WHEN NotificationType = 135  
         THEN N'بطلب إيقاف النشاط الجمركي'
		WHEN NotificationType = 136  
         THEN N'بطلب إعادة تفعيل النشاط الجمركي'
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 143
         THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		WHEN NotificationType = 144
         THEN N'بطلب تحديث مستخدم النظام الجمركي'
		WHEN NotificationType = 145
         THEN N'بطلب إلغاء مستخدم النظام الجمركي'
        END + N' إلى الإدارة المعنية في الجمارك '    
     WHEN WFS.StateName IN (      
       'Submitted'      
       ,'Initial Submitted'      
       )  AND RevokeActionDate IS NOT NULL    
      THEN N'لقد تم ارسال طلبك رقم' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE       
        WHEN NotificationType = 101      
         THEN N'بالاشتراك بالخدمات'      
        WHEN NotificationType = 102      
         THEN N'بخدمة امتحان وكلاء التخليص'      
        WHEN NotificationType = 103      
         THEN N'بخدمة تجديد رخص وكلاء التخليص'      
        WHEN NotificationType = 107      
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'      
        WHEN NotificationType = 106      
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'      
        WHEN NotificationType = 108      
         THEN N'بطلب تحويل المخلص'      
        WHEN NotificationType = 109      
         THEN N'بطلب شهادة إلى من يهمه الأمر'      
        WHEN NotificationType = 110      
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'      
        WHEN NotificationType = 111      
         THEN N'طلب إصدار رخصة التخليص الجمركي '      
        WHEN NotificationType = 120      
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'      
        WHEN NotificationType = 121      
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'      
        WHEN NotificationType = 122      
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'      
        WHEN NotificationType = 123      
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'      
        WHEN NotificationType = 124      
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'      
        WHEN NotificationType = 125      
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'      
        WHEN NotificationType = 126      
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'      
        WHEN NotificationType = 127      
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'      
        WHEN NotificationType = 128      
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'      
        WHEN NotificationType = 129      
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'      
        WHEN NotificationType = 130      
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'      
        WHEN NotificationType = 131      
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'      
        WHEN NotificationType = 132      
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'      
        WHEN NotificationType = 133      
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'
		WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		WHEN NotificationType = 135  
         THEN N'بطلب إيقاف النشاط الجمركي'
		WHEN NotificationType = 136  
         THEN N'بطلب إعادة تفعيل النشاط الجمركي'
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 143
         THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		WHEN NotificationType = 144
         THEN N'بطلب تحديث مستخدم النظام الجمركي'
		WHEN NotificationType = 145
         THEN N'بطلب إلغاء مستخدم النظام الجمركي'
        END + N' وجاري العمل عليه وسيتم إعلامك بالتحديثات علي طلبك تباعاً'    
    
     WHEN WFS.StateName = 'Accepted'    
      THEN N'لقد تم قبول طلبك رقم' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'طلبات تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
        WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		WHEN NotificationType = 135  
         THEN N'بطلب إيقاف النشاط الجمركي'
		WHEN NotificationType = 136  
         THEN N'بطلب إعادة تفعيل النشاط الجمركي'
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 143
         THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		WHEN NotificationType = 144
         THEN N'بطلب تحديث مستخدم النظام الجمركي'
		WHEN NotificationType = 145
         THEN N'بطلب إلغاء مستخدم النظام الجمركي'
		END    
     WHEN WFS.StateName = 'Initial Accepted'    
      THEN N'لقد تم قبول طلبك رقم' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'طلبات تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
        WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		WHEN NotificationType = 135  
         THEN N'بطلب إيقاف النشاط الجمركي'
		WHEN NotificationType = 136  
         THEN N'بطلب إعادة تفعيل النشاط الجمركي'
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 143
         THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		WHEN NotificationType = 144
         THEN N'بطلب تحديث مستخدم النظام الجمركي'
		WHEN NotificationType = 145
         THEN N'بطلب إلغاء مستخدم النظام الجمركي'
		END    
     WHEN WFS.StateName = 'Initial Rejected'    
      THEN N'لقد تم رفض طلبك رقم ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'بطلب تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
        END    
     WHEN WFS.StateName = 'Completed'    
      THEN N'لقد تم أكمال طلبك رقم' + + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'طلبات تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
        WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		WHEN NotificationType = 135  
         THEN N'بطلب إيقاف النشاط الجمركي'
		WHEN NotificationType = 136  
         THEN N'بطلب إعادة تفعيل النشاط الجمركي'
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 143
         THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		WHEN NotificationType = 144
         THEN N'بطلب تحديث مستخدم النظام الجمركي'
		WHEN NotificationType = 145
         THEN N'بطلب إلغاء مستخدم النظام الجمركي'
		END    

     WHEN WFS.StateName = 'Rejected'    
      THEN N'لقد تم رفض طلبك رقم ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'بطلب تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
        WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		WHEN NotificationType = 135  
         THEN N'بطلب إيقاف النشاط الجمركي'
		WHEN NotificationType = 136  
         THEN N'بطلب إعادة تفعيل النشاط الجمركي'
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي'
		WHEN NotificationType = 143
         THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		WHEN NotificationType = 144
         THEN N'بطلب تحديث مستخدم النظام الجمركي'
		WHEN NotificationType = 145
         THEN N'بطلب إلغاء مستخدم النظام الجمركي'
		END    
         -- added bu azhar for id printed case     
        WHEN WFS.StateName = 'ID Printed'    
      THEN N' لقد تم طباعة الكتاب المتعلق بطلبك رقم ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
         WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'بطلب تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
     WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
          END  -- + ' Has been Printed'    
    
     WHEN WFS.StateName = 'Final Rejected'    
      THEN N'لقد تم الرفض النهائي لطلبك رقم ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
        WHEN NotificationType = 101    
         THEN N'بالاشتراك بالخدمات'    
        WHEN NotificationType = 102    
         THEN N'بخدمة امتحان وكلاء التخليص'    
        WHEN NotificationType = 103    
         THEN N'بخدمة تجديد رخص وكلاء التخليص'    
        WHEN NotificationType = 107    
         THEN N'بطلب إلغاء رخصة التخليص الجمركي'    
        WHEN NotificationType = 106    
         THEN N'بطلب إيقاف رخصة التخليص الجمركي'    
        WHEN NotificationType = 108    
         THEN N'بطلب تحويل المخلص'    
        WHEN NotificationType = 109    
         THEN N'بطلب شهادة إلى من يهمه الأمر'    
        WHEN NotificationType = 110    
         THEN N'بطلب طباعة بطاقة هوية التخليص بدل فاقد'    
        WHEN NotificationType = 111    
         THEN N'بطلب إصدار رخصة التخليص الجمركي '    
        WHEN NotificationType = 120    
         THEN N'بطباعة كتاب طلب إلغاء الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 121    
         THEN N'بطباعة كتاب طلب إصدار ترخيص تجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 122    
         THEN N'بطباعة كتاب طلب تغيير عنوان الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 123    
         THEN N'بطباعة كتاب طلب تغيير نشاط الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 124    
         THEN N'بطباعة كتاب طلب إفراج عن الكفالة المصرفية - مراقبة الإيرادات'    
        WHEN NotificationType = 125    
         THEN N'بطباعة كتاب حسن سير وسلوك - الإدارة العامة للأدلة الجنائية'    
        WHEN NotificationType = 126    
         THEN N'بطباعة كتاب طلب تجديد الترخيص التجاري - وزارة التجارة والصناعة'    
        WHEN NotificationType = 127    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 128    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي وتحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 129    
         THEN N'بطباعة كتاب طلب تجديد إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 130    
         THEN N'بطباعة كتاب طلب تحويل إقامة - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 131    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 132    
         THEN N'بطباعة كتاب طلب تغيير مسمى وظيفي ولديه هوية - الهيئة العامة للقوى العاملة'    
        WHEN NotificationType = 133    
         THEN N'كتاب طلب إيقاف الترخيص التجاري للوفاة - وزارة التجارة والصناعة'    
        END    
		--qasem
		WHEN WFS.StateName = 'Initial Approved' 
        THEN N'لقد تم الاعتماد المبدئي لطلبك رقم' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
		 WHEN NotificationType = 134   
         THEN N'بطلب تسجيل نشاط جمركي' 
		 WHEN NotificationType = 111   
        THEN N'بطلب إصدار رخصة التخليص الجمركي '   
		END

		--qasem4
		WHEN WFS.StateName = 'In-Progress'  and NotificationType not in (143,144,145)
        THEN N'طلبك رقم ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
		WHEN NotificationType = 137 
         THEN N'بطلب تسجيل الكفالة المصرفية لنشاط الأعمال الجمركية - قيد التنفيذ حاليا'
		WHEN NotificationType = 138
         THEN N'بطلب تمديد الكفالة المصرفية لنشاط الأعمال الجمركية - قيد التنفيذ حاليا'
		WHEN NotificationType = 139
         THEN N'بطلب الإفراج عن الكفالة المصرفية لنشاط الأعمال الجمركية - قيد التنفيذ حاليا'
		WHEN NotificationType = 140
         THEN N'بطلب تسجيل الكفالة المصرفية للتخليص الجمركي - قيد التنفيذ حاليا'
		WHEN NotificationType = 141
         THEN N'طلب تمديد الكفالة المصرفية للتخليص الجمركي - قيد التنفيذ حاليا'
		WHEN NotificationType = 142
         THEN N'بطلب الافراج عن الكفالة المصرفية للتخليص الجمركي - قيد التنفيذ حاليا'
		-- WHEN NotificationType = 143
		--	 THEN N'بطلب تسجيل مستخدم النظام الجمركي - تم قبول الطلب'
		--WHEN NotificationType = 144
		--	 THEN N'بطلب تحديث مستخدم النظام الجمركي - تم قبول الطلب'
		--WHEN NotificationType = 145
		--	 THEN N'بطلب إلغاء مستخدم النظام الجمركي - تم قبول الطلب'
		WHEN NotificationType = 111
			 THEN  N'بطلب إصدار رخصة التخليص الجمركي - قيد التنفيذ حاليا '   
		 END

		 -- start omar
			WHEN WFS.StateName = 'In-Progress' 
			 THEN ''+ CASE 
			WHEN NotificationType = 143
				THEN N'تم اتخاذ الإجراءات الجمركية على طلبك رقم'  + '( ' + ORs.EserviceRequestNumber + ' ) ' + N'الخاص بتسجيل مستخدم النظام الجمركي، قم بالإقرار باستلام معرف المستخدم وطباعة نموذج الاستلام وتحميله على الطلب  وتقديمه من خلال شاشة عرض الطلب'
			WHEN NotificationType = 144
				THEN N'تم اعتماد طلبك رقم ( '+  ORs.EserviceRequestNumber + N' ) الخاص بتحديث مستخدم النظام الجمركي، وقيد الإجراءات'
			WHEN NotificationType = 145
				THEN N'تم اعتماد طلبك رقم ( '+  ORs.EserviceRequestNumber + N' ) الخاص بإلغاء مستخدم النظام الجمركي، وقيد الإجراءات'
			END
		-- end omar

		 -- start omar
			WHEN WFS.StateName = 'Approved'
			THEN N' لقد تم قبول طلبك رقم' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N'الخاص ب ' + CASE 
	 			WHEN NotificationType = 111 
				 THEN N'طلب إصدار رخصة التخليص الجمركي'
			END
			-- end omar
		--qasem3 

		 -- start omar
			WHEN WFS.StateName = 'Delivered' 
			 THEN ''+ CASE 
			WHEN NotificationType = 143
				THEN N'تم اتخاذ الإجراءات الجمركية على طلبك رقم'  + '( ' + ORs.EserviceRequestNumber + ' ) ' + N'الخاص بتسجيل مستخدم النظام الجمركي، قم بالإقرار باستلام كلمة المرور الخاصة بالمستخدم من خلال شاشة عرض الطلب'
			WHEN NotificationType = 144
				THEN N'تم اعتماد طلبك رقم ( '+  ORs.EserviceRequestNumber + N' ) الخاص بتحديث مستخدم النظام الجمركي، ، قم بالإقرار باستلام كلمة المرور الخاصة بالمستخدم من خلال شاشة عرض الطلب'
			--WHEN NotificationType = 145
			--	THEN N'تم اعتماد طلبك رقم ( '+  ORs.EserviceRequestNumber + N' ) الخاص بإلغاء مستخدم النظام الجمركي، وقيد الإجراءات'
			END
		-- end omar


		--WHEN WFS.StateName = 'Delivered' 
		--  THEN N'لقد تم تسليم بيانات المستخدم الخاص بطلبك رقم ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص ' + CASE     
		--	WHEN NotificationType = 143
		--	 THEN N'بطلب تسجيل مستخدم النظام الجمركي'
		--	WHEN NotificationType = 144
		--	 THEN N'بطلب تحديث مستخدم النظام الجمركي'
		--	WHEN NotificationType = 145
		--	 THEN N'بطلب إلغاء مستخدم النظام الجمركي'
  --		   END
  

     END "msg" 
	 
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   --    LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   INNER JOIN [etrade].EServiceRequests ORs ON ORs.EserviceRequestId = N.ReferenceId   
   --LEFT JOIN [etrade].BRSMOIRequests BRs on BRs.EserviceRequestId = N.ReferenceId   
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara ON WFS_ara.DataProfileClassWFStateId = WFS.DataProfileClassWFStateId   
  -- LEFT JOIN dbo.DataProfileClassWFStates WFS1 ON BRs.StateId = WFS.StateId    
   --LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara1 ON WFS_ara1.DataProfileClassWFStateId = WFS1.DataProfileClassWFStateId   

   WHERE UserId = @mUserId    
    --    AND N.NotificationType = 0          
    AND N.NotificationId = (    
     SELECT max(NotificationId)    
     FROM [etrade].MobileNotification    
     WHERE ReferenceId = N.ReferenceId    and NotificationType not in(146,147,148,149)   
     )    
    
    UNION    
       
   SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    

	case		 
	WHEN BRs.stateid = 'BRSMOIRejectedState'    
      THEN N'لقد تم تعليق ارسال طلب '  + CASE 
	  WHEN NotificationType = 146
			 THEN N'  إصدار رخصة التخليص الجمركي'+  N' رقم ' + '( ' + ORs.EserviceRequestNumber + ' ) '+
			 N' من قبل وزارة الداخلية يرجي الاتصال على الرقم 24313311'
			WHEN NotificationType = 147
			THEN N' تجديد رخص وكلاء التخليص'+  N' رقم ' + '( ' + ORs.EserviceRequestNumber + ' ) '+
			 N' من قبل وزارة الداخلية يرجي الاتصال على الرقم 24313311'
  		   END
		   When BRs.stateid = 'BRSMOIRequestVisit'    
      THEN N'الرجاء مراجعة مكتب وزارة الداخلية لطلب'  + CASE 
	  WHEN NotificationType = 148
			 THEN N'  إصدار رخصة التخليص الجمركي'+  N' رقم ' + '( ' + ORs.EserviceRequestNumber + ' ) '+
			 N'في مطار الكويت الدولي الدور الأول، للاستفسار يرجى الاتصال على تلفون رقم: 24313311'
			WHEN NotificationType = 149
			THEN N' تجديد رخص وكلاء التخليص'+  N' رقم ' + '( ' + ORs.EserviceRequestNumber + ' ) '+
			 N' في مطار الكويت الدولي الدور الأول، للاستفسار يرجى الاتصال على تلفون رقم: 24313311'
  		   END
		       END "msg" ,
			     'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   --    LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   INNER JOIN [etrade].EServiceRequests ORs ON ORs.EserviceRequestId = N.ReferenceId   
   LEFT JOIN [etrade].BRSMOIRequests BRs on BRs.EserviceRequestId = N.ReferenceId   
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara ON WFS_ara.DataProfileClassWFStateId = WFS.DataProfileClassWFStateId   
  -- LEFT JOIN dbo.DataProfileClassWFStates WFS1 ON BRs.StateId = WFS.StateId    
   --LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara1 ON WFS_ara1.DataProfileClassWFStateId = WFS1.DataProfileClassWFStateId   

   WHERE UserId = @mUserId    
    --    AND N.NotificationType = 0          
    AND N.NotificationId = (    
     SELECT MAx(NotificationId)
     FROM [etrade].MobileNotification    
     WHERE ReferenceId = N.ReferenceId and NotificationType in(146,147,148,149)    
     )  
         
     --  WHEN WFS.StateName
       
   UNION    
       
   SELECT N.NotificationType    
    ,D.TempDeclNumber [ReferenceId]    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    /*,N'تم إرسال طلب الدفع بواسطة المخلص' + '-' + D.TempDeclNumber AS "msg"*/    
    ,CASE     
     WHEN OPD.PaymentFor = '1'    
      THEN N'الرسوم ' + N' تم إرسال طلب الدفع بواسطة المخلص إلى' + ISNULL(O.LocalDescription, O.NAME) + '-' + D.TempDeclNumber    
     WHEN OPD.PaymentFor = '2'    
      THEN N'التأمينات ' + N' تم إرسال طلب الدفع بواسطة المخلص إلى' + ISNULL(O.LocalDescription, O.NAME) + '-' + D.TempDeclNumber    
     ELSE N'تم إرسال طلب الدفع بواسطة المخلص' + '-' + D.TempDeclNumber    
     END "msg"    
    ,'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   INNER JOIN dbo.Declarations D ON N.ReferenceId = D.DeclarationId    
    AND N.NotificationType = 1    
   LEFT JOIN OnlinePaymentDetails OPD ON OPD.OPDetailId = N.ReffId    
    AND N.ReffType = 'Epayment'    
   LEFT JOIN Organizations O ON D.ConsigneeId = O.OrganizationId    
    AND D.ConsigneeType = 'O'    
   LEFT JOIN Organizations_ara O_ara ON O.OrganizationId = O_ara.OrganizationId    
   WHERE UserId = @mUserId    
    --order by NotificationId desc          
   
 UNION  
   
 SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    ,N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,          
   
 N' لقد '+Case   
              WHEN (NotificationType  = 8880100 OR  NotificationType  = 8880200 OR NotificationType  = 8880300 OR NotificationType  = 8880400  
              OR NotificationType  = 8880500 OR  NotificationType  = 8880600 OR NotificationType  = 8880700 OR NotificationType  = 8880800  
              OR NotificationType  = 8880900 )  
         THEN N'تم إرسال'   + N'  طلبك ' + ' - ' + N' رقم ' + '( ' + ORs.EserviceRequestNumber  + ' ) '   
               WHEN (NotificationType  = 888011 OR  NotificationType  = 888021 OR NotificationType  = 888031 OR NotificationType  = 888041  
              OR NotificationType  = 888051 OR  NotificationType  = 888061 OR NotificationType  = 888071 OR NotificationType  = 888081  
              OR NotificationType  = 888091 )  
         THEN N' تمت الموافقة على ' + N'  طلبك ' + ' - ' + N' رقم ' + '( ' + ORs.EserviceRequestNumber  + ' ) '   
        WHEN (NotificationType  = 888012 OR  NotificationType  = 888022 OR NotificationType  = 888032 OR NotificationType  = 888042  
              OR NotificationType  = 888052 OR  NotificationType  = 888062 OR NotificationType  = 888072 OR NotificationType  = 888082  
              OR NotificationType  = 888092 )  
         THEN N'تم رفض' + N'  طلبك ' + ' - ' + N' رقم ' + '( ' + ORs.EserviceRequestNumber  + ' ) ' +  N' و ذلك لمايلي ' +  ' * '+  isnull( rd.rejectionremarks,'')+ ' * '  
        WHEN (NotificationType  = 888013 OR  NotificationType  = 888023 OR NotificationType  = 888033 OR NotificationType  = 888043  
              OR NotificationType  = 888053 OR  NotificationType  = 888063 OR NotificationType  = 888073 OR NotificationType  = 888083  
              OR NotificationType  = 888093 )  
         THEN N' تم طلب معلومات إضافية بخصوص ' +  N'  طلبك ' + ' - ' + N' رقم ' + '( ' + ORs.EserviceRequestNumber  + ' ) ' +  N' و ذلك لمايلي ' +  ' * '+ isnull( rd.additionalinforemarks,'') + ' * '  
       WHEN (NotificationType  = 888014 OR  NotificationType  = 888024 OR NotificationType  = 888034 OR NotificationType  = 888044  
              OR NotificationType  = 888054 OR  NotificationType  = 888064 OR NotificationType  = 888074 OR NotificationType  = 888084  
              OR NotificationType  = 888094 )  
         THEN  N' تم طلب حضورك الشخصي الى الإدارة المختصة بتسجيل الشركات بالجمارك بخصوص  ' +  N'  طلبك ' + ' - ' + N' رقم ' + '( ' + ORs.EserviceRequestNumber  + ' ) ' +  N' و ذلك لمايلي ' +  ' * '+ isnull( rd.additionalinforemarks,'') + ' * '   
   end  
  
   +  
      N' الخاص بخدمة ' +  
   --N'  طلبك ' + ' - ' + N' رقم ' + '( ' + ORs.EserviceRequestNumber  + ' ) ' + N' الخاص بخدمة ' +  
    CASE    
        WHEN (NotificationType  = 8880100 or NotificationType  = 888011 OR  NotificationType  = 888012 OR NotificationType  = 888013 OR NotificationType  = 888014)  
         THEN N'تغيير اسم الشركة'   
        WHEN (NotificationType  = 8880200 or NotificationType  = 888021 OR  NotificationType  = 888022 OR NotificationType  = 888023 OR NotificationType  = 888024)  
         THEN N'إضافة رخصة استيراد جديدة'    
        WHEN (NotificationType  = 8880300 or NotificationType  = 888031 OR  NotificationType  = 888032 OR NotificationType  = 888033 OR NotificationType  = 888034)  
         THEN N'تجديد رخصة الاستيراد '   
        WHEN (NotificationType  = 8880400 or NotificationType  = 888041 OR  NotificationType  = 888042 OR NotificationType  = 888043 OR NotificationType  = 888044)  
         THEN N'تجديد الرخصة الصناعية'    
        WHEN (NotificationType  = 8880500 or NotificationType  = 888051 OR  NotificationType  = 888052 OR NotificationType  = 888053 OR NotificationType  = 888054)  
         THEN N'تجديد الرخصة التجارية'    
        WHEN (NotificationType  = 8880600 or NotificationType  = 888061 OR  NotificationType  = 888062 OR NotificationType  = 888063 OR NotificationType  = 888064)  
         THEN N'اضافة مفوض بالتوقيع '    
        WHEN (NotificationType  = 8880700 or NotificationType  = 888071 OR  NotificationType  = 888072 OR NotificationType  = 888073 OR NotificationType  = 888074)  
         THEN N'تجديدالمفوض بالتوقيع' +' * '+ isnull( rd.rejectionremarks,'')+' * '  
        WHEN (NotificationType  = 8880800 or NotificationType  = 888081 OR  NotificationType  = 888082 OR NotificationType  = 888083 OR NotificationType  = 888084)  
         THEN N'حذف المفوض بالتوقيع' +' * '+ isnull( rd.additionalinforemarks,'')+' * '  
        WHEN (NotificationType  = 8880900 or NotificationType  = 888091 OR  NotificationType  = 888092 OR NotificationType  = 888093 OR NotificationType  = 888094)  
         THEN N'تغيير العنوان التجاري'   +' * '+ isnull( rd.RequestForVisitRemarks,'')+' * '  
  
   -- 21 - 11 Abdul Karim   fix  
    
  -- N'طلبك ' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + N' الخاص بخدمة ' + CASE    
  --      WHEN (NotificationType = 8880100 or NotificationType = 888011 OR  NotificationType = 888012 OR NotificationType = 888013 OR NotificationType = 888014)  
  --       THEN N'تغيير اسم الشركة'   
  --      WHEN (NotificationType = 8880200 or NotificationType = 888021 OR NotificationType = 888022 OR NotificationType = 888023 OR NotificationType = 888024)  
  --       THEN N'إضافة رخصة مستورد جديد'    
  --      WHEN (NotificationType = 8880300 or NotificationType = 888031 OR  NotificationType = 888032 OR NotificationType = 888033 OR NotificationType = 888034)  
  --       THEN N'تجديد رخصة المستورد'   
  --      WHEN (NotificationType = 8880400 or NotificationType = 888041 OR  NotificationType = 888042 OR NotificationType = 888043 OR NotificationType = 888044)  
  --       THEN N'تجديد الرخصة الصناعية'    
  --      WHEN (NotificationType = 8880500 or NotificationType = 888051 OR  NotificationType = 888052 OR NotificationType = 888053 OR NotificationType = 888054)  
  --       THEN N'تجديد الرخصة التجارية'    
  --      WHEN (NotificationType = 8880600 or NotificationType = 888061 OR  NotificationType = 888062 OR NotificationType = 888063 OR NotificationType = 888064)  
  --       THEN N'مفوض بالتوقيع الجديد'    
  --      WHEN (NotificationType = 8880700 or NotificationType = 888071 OR  NotificationType = 888072 OR NotificationType = 888073 OR NotificationType = 888074)  
  --       THEN N'تجديد المفوض بالتوقيع'   
  --      WHEN (NotificationType = 8880800 or NotificationType = 888081 OR  NotificationType = 888082 OR NotificationType = 888083 OR NotificationType = 888084)  
  --       THEN N'حذف المفوض بالتوقيع'   
  --      WHEN (NotificationType = 8880900 or NotificationType = 888091 OR  NotificationType = 888092 OR NotificationType = 888093 OR NotificationType = 888094)  
  --       THEN N'تغيير العنوان التجاري'   
           
  --      END + N' لقد '+Case   
  --WHEN (NotificationType = 8880100 OR  NotificationType = 8880200 OR NotificationType = 8880300 OR NotificationType = 8880400  
  -- OR NotificationType = 8880500 OR  NotificationType = 8880600 OR NotificationType = 8880700 OR NotificationType = 8880800  
  -- OR NotificationType = 8880900 )  
  --       THEN N'تم الإرسال'    
  -- WHEN (NotificationType = 888011 OR  NotificationType = 888021 OR NotificationType = 888031 OR NotificationType = 888041  
  -- OR NotificationType = 888051 OR  NotificationType = 888061 OR NotificationType = 888071 OR NotificationType = 888081  
  -- OR NotificationType = 888091 )  
  --       THEN N'تمت الموافقة'   
  --      WHEN (NotificationType = 888012 OR  NotificationType = 888022 OR NotificationType = 888032 OR NotificationType = 888042  
  -- OR NotificationType = 888052 OR  NotificationType = 888062 OR NotificationType = 888072 OR NotificationType = 888082  
  -- OR NotificationType = 888092 )  
  --       THEN N'نبيذ'  +' * '+ isnull( rd.rejectionremarks,'')+' * '  
  --      WHEN (NotificationType = 888013 OR  NotificationType = 888023 OR NotificationType = 888033 OR NotificationType = 888043  
  -- OR NotificationType = 888053 OR  NotificationType = 888063 OR NotificationType = 888073 OR NotificationType = 888083  
  -- OR NotificationType = 888093 )  
  --       THEN N'طلب معلومات إضافية' +' * '+ isnull( rd.additionalinforemarks,'')+' * '  
  --     WHEN (NotificationType = 888014 OR  NotificationType = 888024 OR NotificationType = 888034 OR NotificationType = 888044  
  -- OR NotificationType = 888054 OR  NotificationType = 888064 OR NotificationType = 888074 OR NotificationType = 888084  
  -- OR NotificationType = 888094 )  
  --       THEN N'طلب الزيارة'     
          
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   --    LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   INNER JOIN [etrade].EServiceRequests ORs ON ORs.EserviceRequestId = N.ReferenceId    
   --INNER JOIN [etrade].EServiceRequestsdetails rd ON rd.EserviceRequestId = ORs.EserviceRequestId   
   INNER JOIN [etrade].organizationrequests rd ON rd.requestnumber = ORs.EserviceRequestnumber  
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   WHERE n.UserId = @mUserId    
   AND    
   N.NotificationType IN (888011,  
888012,  
888013,  
888014,  
888021,  
888022,  
888023,  
888024,  
888031,  
888032,  
888033,  
888034,  
888041,  
888042,  
888043,  
888044,  
888051,  
888052,  
888053,  
888054,  
888061,  
888062,  
888063,  
888064,  
888071,  
888072,  
888073,  
888074,  
888081,  
888082,  
888083,  
888084,  
888091,  
888092,  
888093,  
888094
)    

   ) A    
  WHERE A.msg IS NOT NULL    
  ORDER BY A.datecreated DESC    
 END    
 ELSE    
 BEGIN    
  SELECT A.NotificationType    
   ,A.ReferenceId    
   ,A.DateCreated    
   ,A.ReadStatus    
   ,A.msg    
   ,A.TableName    
   ,A.ReffType    
   ,A.ReffId    
       
   ,A.NotificationId    
  FROM (    
   SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    
    --ISNULL(Ors.NAME, ORs.RequestNumber)          
    --+ ' - ' + ISNUll(WFS.StateName, '') AS "msg",          
    CASE     
     WHEN WFS.StateName = 'Approved For Create'    
      THEN 'Your request' + ' - '    
       -- Abdul Karim       
       --+ '( ' + ISNULL(Ors.NAME, ORs.RequestNumber) + ' ) '       
       + ' No. ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 0    
         THEN 'Organization Registration Service '    
        END + ' Has been Approved'    
     WHEN WFS.StateName = 'Approved For Update'    
      THEN 'Your request' + + ' - '    
       -- Abdul Karim       
       --+ '( ' + ISNULL(Ors.NAME, ORs.RequestNumber) + ' ) '       
       + ' No. ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 0    
         THEN 'Organization Registration Service '    
        END + ' Has been Approved'    
     WHEN WFS.StateName = 'Rejected'    
      THEN 'Your request' + ' - '    
       -- Abdul Karim       
       --+ '( ' + ISNULL(Ors.NAME, ORs.RequestNumber) + ' ) '       
       + ' No. ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 0    
         THEN 'Organization Registration Service '    
        END + ' Has been Rejected' + ' Because of ' + ' * ' + Ors.RejectionRemarks + ' * '    
     WHEN WFS.StateName = 'Request to visit Automation team'    
      THEN 'Your Personal Present has been requested by concerned customs of organization registration for your request ' + ' - '    
       -- Abdul Karim       
       --+ '( ' + ISNULL(Ors.NAME, ORs.RequestNumber) + ' ) '       
       + ' No. ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) ' + ' of ' + CASE     
        WHEN NotificationType = 0    
         THEN 'Organization Registration Service '    
        END + ' Because of  ' + ' * ' + Ors.RequestForVisitRemarks + ' * '    
       --+ ' Has been Final Rejected'         
       -- New       
     WHEN WFS.StateName = 'Organization Requested For Create'    
      THEN N' Your Request ' + + ' - ' + ' No. ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) '    
       -- Abdul Karim      
       --+ '( ' +  ISNULL(Ors.LocalDescription, ISNULL(Ors.NAME, ORs.RequestNumber)) + ' ) '         
       + N' of ' + CASE     
        WHEN NotificationType = 0    
         THEN ' Organization Registration Service '    
        END    
       -- End New       
     WHEN WFS.StateName = 'Request Additional Info'    
      THEN 'This Information ' + ' * ' + ORs.AdditionalInfoRemarks + ' * ' + ' has been Requested by concerned customs of organization registration' + ' for your request ' + ' - '    
       -- Abdul Karim              --+ '( ' + ISNULL(Ors.NAME, ORs.RequestNumber) + ' ) '       
       + ' No. ' + '( ' + ISNULL(ORs.RequestNumber, '') + ' ) ' + ' - ( ' + ISNULL(Ors.LocalDescription, '') + ' ) ' + ' of ' + CASE     
        WHEN NotificationType = 0    
         THEN 'Organization Registration Service '    
        END    
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0         
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   WHERE UserId = @mUserId    
    AND N.NotificationType = 0    
    AND N.NotificationId = (    
     SELECT max(NotificationId)    
     FROM [etrade].MobileNotification    
     WHERE ReferenceId = N.ReferenceId    
     )    
   --order by NotificationId desc                          
       
   UNION    
       
   -- added by azhar for notification type 104          
   SELECT DISTINCT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated      
   -- CONVERT(VARCHAR(20), N.DateCreated, 100) AS DateCreated      
    ,N.ReadStatus    
    ,    
    --   '' AS StateName, --WFS.StateName          
    --EA.StateId,          
    --ECI.StateId 'CANDIDATE STATUS',          
    -- ECI.ExamResult,          
    --CASE         
    -- WHEN EA.StateId = 'ExamsAnnouncementsFinalApprovalState' AND ECI.StateId = 'ExamCandidateInfoExamSentState' AND ISNULL(ECI.ExamResult, '') = ''        
    --  THEN CASE         
    --    WHEN NotificationType in (1041,1042,1043)       
    --     THEN 'The date and place of the Customs Clearance Exam have been determined.' + 'Please, Confirm your attendance within 5 days' + 'or else you will be Excluded from the exam'        
    --    END        
    -- --WHEN EA.StateId = 'ExamsAnnouncementsFinalApprovalState' AND ECI.StateId = 'ExamCandidateInfoAttendanceConfirmedState'        
    -- -- THEN CASE         
    -- --   WHEN NotificationType in (1041,1042,1043)       
    -- --    THEN 'You Have Confirmed Exam Attendance for Customs Clearance Exam : ' + CONVERT(VARCHAR, EAD.DateOfExam, 103) + ', ' + EAD.PlaceOfExam   + '  ' + EA.StateId      
    -- --   END        
    -- END     
    CASE     
     --WHEN NotificationType = 1041    
     -- THEN 'The date and place of the Customs Clearance Exam have been determined.' + 'Please, Confirm your attendance within 5 days' + ' or else you will be Excluded from the exam'    
     WHEN NotificationType = 1042    
      THEN 'The date  and place of the Customs Clearance Exam have been determined.' + 'Please, Confirm your attendance within 5 days' + ' or else you will be Excluded from the exam'    
     --WHEN NotificationType = 1043    
     -- THEN 'The date and place of the Customs Clearance Exam have been determined.' + 'Please, Confirm your attendance within 5 days' + ' or else you will be Excluded from the exam'    
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,'' --N.NotificationId        
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   INNER JOIN [$ExamsAnnouncements] EA ON EA.ExamsAnnouncementId = N.ReferenceId    
    AND EA.StateId = 'ExamsAnnouncementsPublicationState'    
   INNER JOIN ExamsAnnouncementDetails EAD ON EAD.ExamsAnnouncementId = EA.ExamsAnnouncementId    
    AND EAD.StateId <> 'ExamsAnnouncementDetailsDeleteState'    
   INNER JOIN [$ExamCandidateInfo] ECI ON ECI.ExamsAnnouncementDetailsId = EAD.ExamsAnnouncementDetailsId    
    AND ECI.StateId IN (    
     'ExamCandidateInfoAttendanceConfirmedState'    
     ,'ExamCandidateInfoExamSentState'    
     )    
   WHERE N.NotificationType IN (    
     --1041,    
     1042    
     --,1043    
     )    
    AND ISNULL(ECI.ExamResult, '') = ''    
    AND UserId = @mUserId --UserId = 423          
    -- modified and resolved issues  Siraj 10-03-2020    
       
   UNION    
       
   -- 105               
   SELECT DISTINCT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    
    --   '' AS StateName, --WFS.StateName          
    --EA.StateId,          
    --ECI.StateId 'CANDIDATE STATUS',          
    --ECI.ExamResult,          
    CASE     
     WHEN NotificationType = 105    
      AND ECI.ExamResult = (    
       SELECT TYPEID    
       FROM TYPES    
       WHERE NAME = 'passed the exam'    
       ) -- 332294315        
      THEN 'You have passed the Customs Clearance Exam successfully, you can request for broker license issuance.' + ' - ' + CC.EnglishFirstName + ' ' + CC.EnglishSecondName + ' ' + CC.EnglishThirdName + ' ' + CC.EnglishLastName    
     WHEN NotificationType = 105    
      AND ECI.ExamResult = (    
       SELECT TYPEID    
       FROM TYPES    
       WHERE NAME = 'not passing the exam'    
       ) --332294316        
      THEN 'You have failed on Customs Clearance Exam. You can retry in the next Exam by sending a new Exam request.' + ' - ' + CC.EnglishFirstName + ' ' + CC.EnglishSecondName + ' ' + CC.EnglishThirdName + ' ' + CC.EnglishLastName    
     WHEN NotificationType = 105    
      AND ECI.ExamResult = (    
       SELECT TYPEID    
       FROM TYPES    
       WHERE NAME = 'Not attending'    
       ) --332294317        
      THEN 'You Did Not Attend The Required Customs Clearance Exam, You can retry in the next Exam by sending a new Exam request.' + ' - ' + CC.EnglishFirstName + ' ' + CC.EnglishSecondName + ' ' + CC.EnglishThirdName + ' ' + CC.EnglishLastName    
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   INNER JOIN [ExamCandidateInfo] ECI ON ECI.ExamsAnnouncementDetailsId = N.ReferenceId    
    AND ECI.StateId = 'ExamCandidateInfoApprovedState'    
   INNER JOIN ETRADE.EServiceRequestsDetails CC ON CC.Eservicerequestid = ECI.Eservicerequestid    
   WHERE N.NotificationType = 105    
    AND N.UserId = @mUserId --UserId = 423          
       
   UNION    
       
   SELECT N.NotificationType    
   ,
    convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    
    --ISNULL(ORs.EserviceRequestNumber,'')          
    -- + ' - ' + ISNUll(WFS.StateName, '') AS "msg",          
    CASE     
		   
	 
     WHEN WFS.StateName IN (    
       'Submitted'    
       ,'Initial Submitted'    
       )AND RevokeActionDate IS NULL ---shk      
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License  Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 134   
         THEN 'Register Custom Business Activity' 
		WHEN NotificationType = 135  
         THEN 'DeActivate Custom Business Activity'
		WHEN NotificationType = 136  
         THEN 'ReActivate Customs Business Activity'
		WHEN NotificationType = 137 
         THEN 'Register Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 138
         THEN 'Extend Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 139
         THEN 'Release Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 140
         THEN 'Register Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 141
         THEN 'Extend Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 142
         THEN 'Release Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 143
         THEN 'Register Customs System User' --qasem2
		WHEN NotificationType = 144
         THEN 'Update Or Activate Customs System User'
		WHEN NotificationType = 145
         THEN 'Deactivate Customs System User'
		--END + ' Has been Submitted'     
        END + ' Has Been '+Case When RevokeActionDate IS NULL Then 'Submitted' Else 'Revoked' END
	   
	 
   --  WHEN WFS.StateName = 'Accepted'  Then '' qasem12/3
	 
	 --WHEN WFS.StateName = ''
     WHEN WFS.StateName = 'Accepted' 
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'  
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
      WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 134   
         THEN 'Register Custom Business Activity' 
		WHEN NotificationType = 135  
         THEN 'DeActivate Custom Business Activity'
		WHEN NotificationType = 136  
         THEN 'ReActivate Customs Business Activity'
		WHEN NotificationType = 137 
         THEN 'Register Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 138
         THEN 'Extend Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 139
         THEN 'Release Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 140
         THEN 'Register Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 141
         THEN 'Extend Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 142
         THEN 'Release Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 143
         THEN 'Register Customs System User'--qasem2
		WHEN NotificationType = 144
         THEN 'Update Or Activate Customs System User'
		WHEN NotificationType = 145
         THEN 'Deactivate Customs System User'
		END + ' Has been Approved'    
     WHEN WFS.StateName = 'Initial Accepted'    
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 134   
         THEN 'Register Custom Business Activity' 
		WHEN NotificationType = 135  
         THEN 'DeActivate Custom Business Activity'
		WHEN NotificationType = 136  
         THEN 'ReActivate Customs Business Activity'
		WHEN NotificationType = 137 
         THEN 'Register Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 138
         THEN 'Extend Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 139
         THEN 'Release Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 140
         THEN 'Register Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 141
         THEN 'Extend Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 142
         THEN 'Release Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 143
         THEN 'Register Customs System User'--qasem
		WHEN NotificationType = 144
         THEN 'Update Or Activate Customs System User'
		WHEN NotificationType = 145
         THEN 'Deactivate Customs System User'
		END + ' Has been Initial Accepted'    
     WHEN WFS.StateName = 'Initial Rejected'    
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
      WHEN NotificationType = 110    
         THEN 'Print Lost Broker License  Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        END + ' Has been Initial Rejected'    
     WHEN WFS.StateName = 'Completed'    
      THEN 'Your request' + + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License  Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 134   
         THEN 'Register Custom Business Activity' 
		WHEN NotificationType = 135  
         THEN 'DeActivate Custom Business Activity'
		WHEN NotificationType = 136  
         THEN 'ReActivate Customs Business Activity'
		WHEN NotificationType = 137 
         THEN 'Register Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 138
         THEN 'Extend Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 139
         THEN 'Release Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 140
         THEN 'Register Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 141
         THEN 'Extend Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 142
         THEN 'Release Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 143
         THEN 'Register Customs System User'--qasem2
		WHEN NotificationType = 144
         THEN 'Update Or Activate Customs System User'
		WHEN NotificationType = 145
         THEN 'Deactivate Customs System User'
		END + ' has been Completed'    
     WHEN WFS.StateName = 'Rejected'    
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License  Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 134   
         THEN 'Register Custom Business Activity' 
		WHEN NotificationType = 135  
         THEN 'DeActivate Custom Business Activity'
		WHEN NotificationType = 136  
         THEN 'ReActivate Customs Business Activity'
		WHEN NotificationType = 137 
         THEN 'Register Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 138
         THEN 'Extend Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 139
         THEN 'Release Bank Guarantee For Customs Business Activity'
		WHEN NotificationType = 140
         THEN 'Register Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 141
         THEN 'Extend Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 142
         THEN 'Release Bank Guarantee For Customs Clearance'
		WHEN NotificationType = 143
         THEN 'Register Customs System User'--qasem2
		WHEN NotificationType = 144
         THEN 'Update Or Activate Customs System User'
		WHEN NotificationType = 145
         THEN 'Deactivate Customs System User'
	
		END+ ' Has been Rejected'    
        -- added bu azhar for id printed case  
	
        WHEN WFS.StateName = 'ID Printed'    
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License  Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        END+ ' Has been Printed'    
    
     WHEN WFS.StateName = 'Final Rejected'    
      THEN 'Your request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE     
        WHEN NotificationType = 101    
         THEN 'Service Subscription'    
        WHEN NotificationType = 102    
         THEN N'Clearing Agent Exam Service'    
        WHEN NotificationType = 103    
         THEN 'Renewing  Broker License Service'    
        WHEN NotificationType = 107    
         THEN 'Broker License Cancellation Requests'    
        WHEN NotificationType = 106    
         THEN 'Deactivate Broker License Request'    
        WHEN NotificationType = 108    
         THEN 'Broker Transfer Requests'    
        WHEN NotificationType = 109    
         THEN 'To Whom It Concern Letter Request'    
        WHEN NotificationType = 110    
         THEN 'Print Lost Broker License  Card Request'    
        WHEN NotificationType = 111    
         THEN 'Broker License Issuance Request'    
        WHEN NotificationType = 120    
         THEN 'Cancel Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 121    
         THEN 'Issue Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 122    
         THEN 'Change Commercial License Address Letter - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 123    
         THEN 'Change Commercial License Business - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 124    
         THEN 'Release Bank Guarantee - Revenue Control Request'    
        WHEN NotificationType = 125    
         THEN 'Good conduct and behavior - General Directorate of Criminal Evidence Request'    
        WHEN NotificationType = 126    
         THEN 'Renew Commercial License - Ministry of Commerce and Industry Request'    
        WHEN NotificationType = 127    
         THEN 'Change Job Title and Renew Residency - General Authority for Manpower Request'    
        WHEN NotificationType = 128    
         THEN 'Change Job Title and Transfer Residency- General Authority for Manpower Request'    
        WHEN NotificationType = 129    
         THEN 'Residency Renew - General Authority for Manpower Request'    
        WHEN NotificationType = 130    
         THEN 'Residency Transfer - General Authority for Manpower Request'    
        WHEN NotificationType = 131    
         THEN 'Change Job Title - General Authority for Manpower Request'    
        WHEN NotificationType = 132    
         THEN 'Change Job Title - With Broker License - General Authority for Manpower Request'    
        WHEN NotificationType = 133    
         THEN 'Deactivate Commercial License - Death - Ministry of Commerce and Industry Request'    
        END + ' Has been Final Rejected'    
	--add by qasem for Initial Approved status
	WHEN WFS.StateName = 'Initial Approved' 
	 THEN 'Your Request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE 
	   WHEN NotificationType = 134   
         THEN 'Register Custom Business Activity' 
		WHEN NotificationType = 111   
          THEN 'Broker Licence Issuance'
	END + ' Has Been Initial Approved'   
    
	--omar
	WHEN WFS.StateName = 'Approved'
	THEN 'Your Request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE 
	 	WHEN NotificationType = 111 
         THEN 'Broker Licence Issuance Has Been Approved'
	END
	--qasem2 
	WHEN WFS.StateName = 'In-Progress' and NotificationType not in (143,144,145) --omar
	 THEN 'Your Request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE 
	 	WHEN NotificationType = 137 
         THEN 'Register Bank Guarantee For Customs Business Activity Is Currently In Progress'
		WHEN NotificationType = 138
         THEN 'Extend Bank Guarantee For Customs Business Activity Is Currently In Progress'
		WHEN NotificationType = 139
         THEN 'Release Bank Guarantee For Customs Business Activity Is Currently In Progress' 
		WHEN NotificationType = 140
         THEN 'Register Bank Guarantee For Customs Clearance Is Currently In Progress'
		WHEN NotificationType = 141
         THEN 'Extend Bank Guarantee For Customs Clearance Is Currently In Progress'
		WHEN NotificationType = 142
         THEN 'Release Bank Guarantee For Customs Clearance Is Currently In Progress'
		--WHEN NotificationType = 143
  --       THEN 'Register Customs System User Has been Approved' 
		--WHEN NotificationType = 144
  --       THEN 'Update Or Activate Customs System User Has been Approved'
		--WHEN NotificationType = 145
  --       THEN 'Deactivate Customs System User Has been Approved'
		 WHEN NotificationType = 111
         THEN 'Broker License Issuance Is Currently In Progress'
	END  
	
	-- start omar
	WHEN WFS.StateName = 'In-Progress' 
	 THEN ''+ CASE 
	WHEN NotificationType = 143
        THEN 'Your user system user registration request number ( '+  ORs.EserviceRequestNumber +' ) has been processed, Acknowledge the user ID recipient and Print& Upload the Recipient Form from the request view screen.' 
	WHEN NotificationType = 144
        THEN 'Your user system user update request number ( '+  ORs.EserviceRequestNumber +' ) has been accepted.'
	WHEN NotificationType = 145
        THEN 'Your user system user deactivate request number ( '+  ORs.EserviceRequestNumber +' ) has been accepted.'
	END
	-- end omar


	-- start omar
			WHEN WFS.StateName = 'Delivered' 
			 THEN ''+ CASE 
			WHEN NotificationType = 143
				THEN 'Your user system user registration request number'  + '( ' + ORs.EserviceRequestNumber + ' ) ' + 'has been processed, Acknowledge the user password recipient from the request view screen.'
			WHEN NotificationType = 144
				THEN  'Your user system user update request number'  + '( ' + ORs.EserviceRequestNumber + ' ) ' + 'has been processed, Acknowledge the user password recipient from the request view screen.'
			--WHEN NotificationType = 145
			--	THEN N'تم اعتماد طلبك رقم ( '+  ORs.EserviceRequestNumber + N' ) الخاص بإلغاء مستخدم النظام الجمركي، وقيد الإجراءات'
			END
		-- end omar
	--qasem3
	--WHEN WFS.StateName = 'Delivered' 
	-- THEN 'The User Details For Request' + ' - ' + '( ' + ORs.EserviceRequestNumber + ' ) ' + ' For ' + CASE 
	-- WHEN NotificationType = 143
 --        THEN 'Register Customs System User' 
	--	WHEN NotificationType = 144
 --        THEN 'Update Or Activate Customs System User'
	--	WHEN NotificationType = 145
 --        THEN 'Deactivate Customs System User'
	--END + ' Has Been Delivered'   
 





       --WHEN WFS.StateName = 'Final Rejected'          
       --                           THEN 'Your request'             
       --                                + ' - '           
       --                                + '( ' +  ORs.EserviceRequestNumber + ' ) '          
       --                                + ' For '          
       --                                +          
       --                                CASE           
       --                                WHEN NotificationType = 101          
       --                                THEN 'Service Subscription'          
       --                                WHEN NotificationType = 102          
       --                                THEN N'Clearing Agent Exam Service'          
       --                                WHEN NotificationType = 103          
       --                                THEN 'Renewing  Broker License Service'            
       --                                END          
       --                                 + ' Has been Final Rejected'        
   
     END "msg"    
    ,    
    -- Abd          
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   --    LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   INNER JOIN [etrade].EServiceRequests ORs ON ORs.EserviceRequestId = N.ReferenceId   
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   WHERE UserId = @mUserId    
    --    AND N.NotificationType = 0          
    AND N.NotificationId = (    
     SELECT max(NotificationId)    
     FROM [etrade].MobileNotification    
     WHERE ReferenceId = N.ReferenceId   and NotificationType not in(146,147,148,149)   
     )
	   
    UNION    
       
   SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,    
	case  WHEN BRs.StateId = 'BRSMOIRejectedState'   
			       THEN 'Submission of the ' +  CASE     

			   	WHEN NotificationType = 146
         THEN 'Broker License Issuance Request'
		  	WHEN NotificationType = 147
         THEN 'Renewing  Broker License Service'
		END+  ' Number ' + '( ' + ORs.EserviceRequestNumber + ' ) '+' has been suspended by the Ministry of Interior. Please contact the following number: 24313311 '  

		When
		BRs.StateId = 'BRSMOIRequestVisit'   
			       THEN 'Please visit the MOI Office for ' +  CASE     

			   	WHEN NotificationType = 148
         THEN 'Broker License Issuance Request'
		  	WHEN NotificationType = 149
         THEN 'Renewing  Broker License Request'
		END+  ' Number ' + '( ' + ORs.EserviceRequestNumber + ' ) '+' at the Kuwait International Airport, Second Floor. For Further Inquiries please contact Telephone Number: 24313311 '  
		       END "msg" ,
			     'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   --    LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   INNER JOIN [etrade].EServiceRequests ORs ON ORs.EserviceRequestId = N.ReferenceId   
   LEFT JOIN [etrade].BRSMOIRequests BRs on BRs.EserviceRequestId = N.ReferenceId   
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara ON WFS_ara.DataProfileClassWFStateId = WFS.DataProfileClassWFStateId   
  -- LEFT JOIN dbo.DataProfileClassWFStates WFS1 ON BRs.StateId = WFS.StateId    
   --LEFT JOIN dbo.DataProfileClassWFStates_ara WFs_ara1 ON WFS_ara1.DataProfileClassWFStateId = WFS1.DataProfileClassWFStateId   

   WHERE UserId = @mUserId    
    --    AND N.NotificationType = 0          
    AND N.NotificationId = (    
     SELECT max(NotificationId)    
     FROM [etrade].MobileNotification    
     WHERE ReferenceId = N.ReferenceId and NotificationType in(146,147,148,149)    
     )  
       
   UNION    
       
   SELECT N.NotificationType    
    ,D.TempDeclNumber [ReferenceId]    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    /*,N'Payment Request sent by broker' + '-' + D.TempDeclNumber  END AS "msg"*/    
    ,CASE     
     WHEN OPD.PaymentFor = '1'    
      THEN N'Duties ' + N'payment request sent by broker to ' + ISNULL(O.NAME, O.LocalDescription) + '-' + D.TempDeclNumber    
     WHEN OPD.PaymentFor = '2'    
      THEN N'Deposits ' + N'payment request sent by broker to ' + ISNULL(O.NAME, O.LocalDescription) + '-' + D.TempDeclNumber    
     ELSE N'Payment Request sent by broker' + '-' + D.TempDeclNumber    
     END "msg"    
    ,'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   INNER JOIN dbo.Declarations D ON N.ReferenceId = D.DeclarationId    
    AND N.NotificationType = 1    
   LEFT JOIN OnlinePaymentDetails OPD ON OPD.OPDetailId = N.ReffId    
    AND N.ReffType = 'Epayment'    
   LEFT JOIN Organizations O ON D.ConsigneeId = O.OrganizationId    
    AND D.ConsigneeType = 'O'    
   LEFT JOIN Organizations_ara O_ara ON O.OrganizationId = O_ara.OrganizationId    
   WHERE UserId = @mUserId    
    --order by NotificationId desc      
   
   
 UNION  
   
 ALL SELECT N.NotificationType    
    ,convert(VARCHAR(50), N.ReferenceId) AS ReferenceId    
    , N.DateCreated AS DateCreated    
    ,N.ReadStatus    
    ,           
    N'Your request' + N' - ' + N'( ' + ORs.EserviceRequestNumber + N' ) ' + N' For ' + CASE   
        WHEN (NotificationType = 8880100 or NotificationType = 888011 OR  NotificationType = 888012 OR NotificationType = 888013 OR NotificationType = 888014)  
         THEN N'Organization Name Change'   
        WHEN (NotificationType = 8880200 or NotificationType = 888021 OR  NotificationType = 888022 OR NotificationType = 888023 OR NotificationType = 888024)  
         THEN N'Add New Importer License'    
        WHEN (NotificationType = 8880300 or NotificationType = 888031 OR  NotificationType = 888032 OR NotificationType = 888033 OR NotificationType = 888034)  
         THEN N'Renew Importer License'   
        WHEN (NotificationType = 8880400 or NotificationType = 888041 OR  NotificationType = 888042 OR NotificationType = 888043 OR NotificationType = 888044)  
         THEN N'Renew Industrial License'    
        WHEN (NotificationType = 8880500 or NotificationType = 888051 OR  NotificationType = 888052 OR NotificationType = 888053 OR NotificationType = 888054)  
         THEN N'Renew Commercial License'    
        WHEN (NotificationType = 8880600 or NotificationType = 888061 OR  NotificationType = 888062 OR NotificationType = 888063 OR NotificationType = 888064)  
         THEN N'New Authorized Signatory'    
        WHEN (NotificationType = 8880700 or NotificationType = 888071 OR  NotificationType = 888072 OR NotificationType = 888073 OR NotificationType = 888074)  
         THEN N'Renew Authorized Signatory'   
        WHEN (NotificationType = 8880800 or NotificationType = 888081 OR  NotificationType = 888082 OR NotificationType = 888083 OR NotificationType = 888084)  
         THEN N'Remove Authorized Signatory'   
        WHEN (NotificationType = 8880900 or NotificationType = 888091 OR  NotificationType = 888092 OR NotificationType = 888093 OR NotificationType = 888094)  
         THEN N'Change Commercial Address'   
           
        END + N' Has Been '+Case   
  WHEN (NotificationType = 8880100 OR  NotificationType = 8880200 OR NotificationType = 8880300 OR NotificationType = 8880400  
   OR NotificationType = 8880500 OR  NotificationType = 8880600 OR NotificationType = 8880700 OR NotificationType = 8880800  
   OR NotificationType = 8880900 )  
         THEN N'Submitted'    
   WHEN (NotificationType = 888011 OR  NotificationType = 888021 OR NotificationType = 888031 OR NotificationType = 888041  
   OR NotificationType = 888051 OR  NotificationType = 888061 OR NotificationType = 888071 OR NotificationType = 888081  
   OR NotificationType = 888091 )  
         THEN N'Approved'   
        WHEN (NotificationType = 888012 OR  NotificationType = 888022 OR NotificationType = 888032 OR NotificationType = 888042  
   OR NotificationType = 888052 OR  NotificationType = 888062 OR NotificationType = 888072 OR NotificationType = 888082  
   OR NotificationType = 888092 )  
         THEN N'Rejected'  +' * '+ isnull( rd.rejectionremarks,'')+' * '  
        WHEN (NotificationType = 888013 OR  NotificationType = 888023 OR NotificationType = 888033 OR NotificationType = 888043  
   OR NotificationType = 888053 OR  NotificationType = 888063 OR NotificationType = 888073 OR NotificationType = 888083  
   OR NotificationType = 888093 )  
         THEN N'Requested for Additional Info' +' * '+ isnull( rd.additionalinforemarks,'')+' * '  
       WHEN (NotificationType = 888014 OR  NotificationType = 888024 OR NotificationType = 888034 OR NotificationType = 888044  
   OR NotificationType = 888054 OR  NotificationType = 888064 OR NotificationType = 888074 OR NotificationType = 888084  
   OR NotificationType = 888094 )  
         THEN N'Requested for Visit'   +' * '+ isnull( rd.RequestForVisitRemarks,'')+' * '  
          
     END "msg"    
    ,    
    -- Abd   select * from etrade.OrganizationRequests       
    'NotificationsList' AS "TableName"    
    ,N.NotificationId    
    ,N.ReffType AS ReffType    
    ,N.ReffId AS ReffId    
   FROM [etrade].MobileNotification N    
   --    LEFT JOIN [etrade].OrganizationRequests ORs ON ORs.OrganizationRequestId = N.ReferenceId --And N.NotificationType=0                        
   INNER JOIN [etrade].EServiceRequests ORs ON ORs.EserviceRequestId = N.ReferenceId    
   --INNER JOIN [etrade].EServiceRequestsdetails rd ON rd.EserviceRequestId = ORs.EserviceRequestId   
   INNER JOIN [etrade].organizationrequests rd ON rd.requestnumber = ORs.Eservicerequestnumber  
   LEFT JOIN dbo.DataProfileClassWFStates WFS ON ORs.StateId = WFS.StateId    
   WHERE n.UserId = @mUserId    
   AND    
   N.NotificationType IN (888011,  
888012,  
888013,  
888014,  
888021,  
888022,  
888023,  
888024,  
888031,  
888032,  
888033,  
888034,  
888041,  
888042,  
888043,  
888044,  
888051,  
888052,  
888053,  
888054,  
888061,  
888062,  
888063,  
888064,  
888071,  
888072,  
888073,  
888074,  
888081,  
888082,  
888083,  
888084,  
888091,  
888092,  
888093,  
888094
)  
--rama

   ) A    
  WHERE A.msg IS NOT NULL --AND --A.NotificationType NOT IN (1041,1043)    
  --and A.NotificationType  NOT IN (    
  --   --1041,    
  --   1042)    
 --ORDER BY A.NotificationId DESC    
ORDER BY A.DateCreated DESC    
 END    
   UPDATE  [etrade].MobileNotification          
   SET     ReadStatus = '1'          
   WHERE   UserId = @mUserId          
           AND ReadStatus = '0'            
END



